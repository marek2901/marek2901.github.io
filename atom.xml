<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Ruby Mark]]></title>
  <link href="http://marek2901.github.io/atom.xml" rel="self"/>
  <link href="http://marek2901.github.io/"/>
  <updated>2016-06-01T01:16:30+02:00</updated>
  <id>http://marek2901.github.io/</id>
  <author>
    <name><![CDATA[Marek Dziewit]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[#RAD With Sinatra Part 2]]></title>
    <link href="http://marek2901.github.io/blog/2016/05/31/number-rad-with-sinatra-part-2/"/>
    <updated>2016-05-31T22:02:15+02:00</updated>
    <id>http://marek2901.github.io/blog/2016/05/31/number-rad-with-sinatra-part-2</id>
    <content type="html"><![CDATA[<p><a href="http://marek2901.github.io/blog/2016/05/29/number-rad-with-sinatra/">Previously</a> on my blog I was covering Rapid app development with sinatra and Hazel,
So far I&rsquo;ve created basic app skeleton, add some index and view action to our blog like hello world.</p>

<p>In this post we will try to complete other REST actions like Creating Updatind Deleting a blog post.</p>

<!-- more -->


<p>I&rsquo;d like to notice one thing on the begining. Hazel is not that RAD As i wanted it to be, comparing to Rails when you simply type</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails generate scaffold Post title:string body:text</span></code></pre></td></tr></table></div></figure>


<p>and that&rsquo;s all. In sinatra we have to do a bit more work.</p>

<h2>Missing actions</h2>

<p>There is only two actions posts an view post, so it need to be extended:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">HelloBlog</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">## IMPORTANT set this to true so you can set request method in form using hidden field</span>
</span><span class='line'>  <span class="c1">## modern browser don&#39;t support put delete patch requests :(</span>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:method_override</span><span class="p">,</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:public_folder</span> <span class="o">=&gt;</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span> <span class="ss">:static</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">get</span> <span class="s2">&quot;/&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">erb</span> <span class="ss">:posts</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">get</span> <span class="s2">&quot;/posts/:id&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="n">erb</span> <span class="ss">:post</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">get</span> <span class="s2">&quot;/post/new&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">erb</span> <span class="ss">:form_post</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">post</span> <span class="s2">&quot;/posts&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">Post</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:post</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>    <span class="n">redirect</span> <span class="s2">&quot;/&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;/post/:id/edit&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="n">erb</span> <span class="ss">:form_post</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">put</span> <span class="s1">&#39;/posts/:id&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">Post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:post</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>    <span class="n">redirect</span> <span class="s2">&quot;/&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">delete</span> <span class="s1">&#39;/posts/:id&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">Post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span>
</span><span class='line'>    <span class="n">redirect</span> <span class="s2">&quot;/&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Form Post view</h2>

<p>I&rsquo;m bit lazy, so I create only one view for create and update :)</p>

<p>views/form_post.erb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;h2&gt;</span><span class="err">&lt;</span>%= @post.nil? ? &quot;Create&quot; : &quot;Update&quot; %&gt; Post<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;&lt;%= url @post.nil? ? &quot;</span><span class="err">/</span><span class="na">posts</span><span class="err">&quot;</span> <span class="na">:</span> <span class="err">&quot;/</span><span class="na">posts</span><span class="err">/#{@</span><span class="na">post</span><span class="err">.</span><span class="na">id</span><span class="err">}&quot;</span> <span class="err">%</span><span class="nt">&gt;</span>&quot; method=&quot;post&quot;&gt;
</span><span class='line'>    <span class="err">&lt;</span>% unless @post.nil? %&gt;
</span><span class='line'>      <span class="c">&lt;!-- NOTICE HOW METHOD PUT IS OVERRIDEN --&gt;</span>
</span><span class='line'>      <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;_method&quot;</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">value=</span><span class="s">&quot;put&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>% end %&gt;
</span><span class='line'>    <span class="nt">&lt;label&gt;</span>Title<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;post[title]&quot;</span> <span class="na">value=</span><span class="s">&quot;&lt;%= @post ? @post.title  : &quot;</span><span class="err">&quot;</span> <span class="err">%</span><span class="nt">&gt;</span>&quot;/&gt;
</span><span class='line'>    <span class="nt">&lt;label&gt;</span>Body<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;post[body]&quot;</span> <span class="na">value=</span><span class="s">&quot;&lt;%= @post ? @post.body : &quot;</span><span class="err">&quot;</span> <span class="err">%</span><span class="nt">&gt;</span>&quot;/&gt;
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span>  <span class="na">value=</span><span class="s">&quot;&lt;%= @post.nil? ? &quot;</span><span class="na">Create</span><span class="err">&quot;</span> <span class="na">:</span> <span class="err">&quot;</span><span class="na">Update</span><span class="err">&quot;</span> <span class="err">%</span><span class="nt">&gt;</span>&quot;/&gt;
</span><span class='line'>  <span class="nt">&lt;/form&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;sidebar&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h3&gt;</span>Environment<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Ruby:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= RUBY_VERSION %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Environment:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= ENV[&quot;RACK_ENV&quot;] %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Server:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= @env[&quot;SERVER_SOFTWARE&quot;] %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Port:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= @env[&quot;SERVER_PORT&quot;] %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Add buttons to previous views:</h2>

<p>views/posts.erb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;h2&gt;</span>Posts<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>% Post.all.each do |e| %&gt;
</span><span class='line'>      <span class="nt">&lt;li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&lt;%= url &quot;</span><span class="na">posts</span><span class="err">/#{</span><span class="na">e</span><span class="err">.</span><span class="na">id</span><span class="err">}&quot;</span> <span class="err">%</span><span class="nt">&gt;</span>&quot;&gt;
</span><span class='line'>          <span class="nt">&lt;h4&gt;</span><span class="err">&lt;</span>%= e.title %&gt;<span class="nt">&lt;/h4&gt;&lt;/br&gt;&lt;/a&gt;</span>
</span><span class='line'>          <span class="nt">&lt;p&gt;</span><span class="err">&lt;</span>%= e.body.truncate(10) || &quot;N/A&quot; rescue &quot;N/A&quot; %&gt;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>% end %&gt;
</span><span class='line'>  <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">&lt;!-- ADD THIS LINE --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&lt;%= url &quot;</span><span class="err">/</span><span class="na">post</span><span class="err">/</span><span class="na">new</span><span class="err">&quot;</span> <span class="err">%</span><span class="nt">&gt;</span>&quot;&gt;Create new<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;sidebar&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h3&gt;</span>Environment<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Ruby:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= RUBY_VERSION %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Environment:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= ENV[&quot;RACK_ENV&quot;] %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Server:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= @env[&quot;SERVER_SOFTWARE&quot;] %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Port:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= @env[&quot;SERVER_PORT&quot;] %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>views/post.erb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;h2&gt;</span><span class="err">&lt;</span>%= @post.title %&gt;<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;p&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>%= @post.body %&gt;
</span><span class='line'>  <span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">&lt;!-- add this section with link and delete button --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&lt;%= url &quot;</span><span class="err">/</span><span class="na">post</span><span class="err">/#{@</span><span class="na">post</span><span class="err">.</span><span class="na">id</span><span class="err">}/</span><span class="na">edit</span><span class="err">&quot;</span> <span class="err">%</span><span class="nt">&gt;</span>&quot;&gt;Edit<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>  <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;&lt;%= url &quot;</span><span class="err">/</span><span class="na">posts</span><span class="err">/#{@</span><span class="na">post</span><span class="err">.</span><span class="na">id</span><span class="err">}&quot;</span> <span class="err">%</span><span class="nt">&gt;</span>&quot; method=&quot;post&quot;&gt;
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;_method&quot;</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">value=</span><span class="s">&quot;delete&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Delete&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/form&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;sidebar&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h3&gt;</span>Environment<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Ruby:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= RUBY_VERSION %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Environment:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= ENV[&quot;RACK_ENV&quot;] %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Server:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= @env[&quot;SERVER_SOFTWARE&quot;] %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Port:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= @env[&quot;SERVER_PORT&quot;] %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And thats it, simple hello world scaffold in sinatra. In rails you get that by executing one command, so thats not end of my journey, I&rsquo;ll keep looking for better solutions :) see you again on my blog.</p>

<p>all code is avalible on <a href="https://github.com/marek2901/sinatra-scaffold-blog">github repo</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[#RAD With Sinatra Part 1]]></title>
    <link href="http://marek2901.github.io/blog/2016/05/29/number-rad-with-sinatra/"/>
    <updated>2016-05-29T16:25:49+02:00</updated>
    <id>http://marek2901.github.io/blog/2016/05/29/number-rad-with-sinatra</id>
    <content type="html"><![CDATA[<h2>RAD</h2>

<p>RAD - Rapid Application Development, it&rsquo;s a style of creating applications, that allows you get things done quickly,
this philosophy is highly used in Rails framework.</p>

<!-- more -->


<h2>Sinatra</h2>

<p>For those of you who might not know sinatra is minimalistic ruby web framework, to run simple hello world simply install gems</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install sinatra</span></code></pre></td></tr></table></div></figure>


<p>Create file named for example <code>sinatra_hello.rb</code> with this content</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;sinatra&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="s2">&quot;Hello World&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>now simple command</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">ruby</span> <span class="n">sinatra_hello</span><span class="o">.</span><span class="n">rb</span>
</span></code></pre></td></tr></table></div></figure>


<p>And it&rsquo;s done!! Simple web server created!!</p>

<p>But wait, sure we can write web server one liner. But what with database connection, templating system, getting users params.
All that you have to code by yourself, which means lot of work, and many programming decisions that can make things bad!</p>

<p>So Sinatra is not RAD framework at all!!</p>

<h2>The Challenge</h2>

<p>Sinatra doesn&rsquo;t have rad features by default, but with a bit help of community we can achieve rails like development style.</p>

<p>There is tool called <a target="_blank" href="https://github.com/c7/hazel">hazel</a> that lets you help creating sinatra app quickly reallyy guickly!!</p>

<h3>Generate template</h3>

<p>Let&rsquo;s use postgresql for database engine (you can have more options like mysql,redis)
To begin simply type</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">hazel</span> <span class="n">hello_blog</span> <span class="o">-</span><span class="n">d</span> <span class="n">postgresql</span> <span class="o">--</span><span class="n">bundle</span>
</span></code></pre></td></tr></table></div></figure>


<p>run &ndash;bundle option for automatic bundle install</p>

<p>Output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">initializers</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">lib</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">spec</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">db</span><span class="o">/</span><span class="n">migrate</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">lib</span><span class="o">/.</span><span class="n">gitkeep</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="kp">public</span><span class="o">/</span><span class="n">stylesheets</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="kp">public</span><span class="o">/</span><span class="n">stylesheets</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">css</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="kp">public</span><span class="o">/</span><span class="n">javascripts</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="kp">public</span><span class="o">/</span><span class="n">javascripts</span><span class="o">/.</span><span class="n">gitkeep</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="kp">public</span><span class="o">/</span><span class="n">images</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="kp">public</span><span class="o">/</span><span class="n">images</span><span class="o">/.</span><span class="n">gitkeep</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="kp">public</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">hazel_icon</span><span class="o">.</span><span class="n">png</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="kp">public</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">hazel_small</span><span class="o">.</span><span class="n">png</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="kp">public</span><span class="o">/</span><span class="n">favicon</span><span class="o">.</span><span class="n">ico</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">views</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">views</span><span class="o">/</span><span class="n">layout</span><span class="o">.</span><span class="n">erb</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">views</span><span class="o">/</span><span class="n">welcome</span><span class="o">.</span><span class="n">erb</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">hello_blog</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">spec</span><span class="o">/</span><span class="n">hello_blog_spec</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">spec</span><span class="o">/</span><span class="n">spec_helper</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">ru</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="no">Gemfile</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="no">Rakefile</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="no">README</span><span class="o">.</span><span class="n">md</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">db</span><span class="o">.</span><span class="n">yml</span>
</span><span class='line'>  <span class="n">create</span>  <span class="n">hello_blog</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">initializers</span><span class="o">/</span><span class="n">database</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'>     <span class="n">run</span>  <span class="n">bundle</span> <span class="n">from</span> <span class="s2">&quot;./hello_blog&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>now setup your database connection:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">development</span><span class="p">:</span>
</span><span class='line'> <span class="ss">adapter</span><span class="p">:</span> <span class="n">postgresql</span>
</span><span class='line'> <span class="ss">host</span><span class="p">:</span> <span class="n">localhost</span>
</span><span class='line'> <span class="ss">database</span><span class="p">:</span> <span class="n">blog</span>
</span><span class='line'> <span class="ss">user</span><span class="p">:</span> <span class="n">user</span>
</span><span class='line'> <span class="ss">password</span><span class="p">:</span> <span class="n">password</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>warning, you need to have rake commands avalible, in my case there were issue with them, rake couldn't found environment task, so I've created one:</code></p>

<p>Rakefile</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">task</span> <span class="ss">:environment</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">require</span> <span class="s2">&quot;./env_loader&quot;</span>
</span><span class='line'>  <span class="nb">require</span> <span class="s2">&quot;./hello_blog&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you see i created env_loader in main dir, it basically extracts few first lines from config.ru so i can reuse them here</p>

<p>Content of env_loader extrated from config.ru</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vg">$LOAD_PATH</span> <span class="o">&lt;&lt;</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#set default env as development can be overriden</span>
</span><span class='line'><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;RACK_ENV&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="s2">&quot;development&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;bundler&quot;</span>
</span><span class='line'><span class="no">Bundler</span><span class="o">.</span><span class="n">require</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Local config</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;find&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="sx">%w{config/initializers lib}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">load_path</span><span class="o">|</span>
</span><span class='line'>  <span class="no">Find</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">load_path</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>    <span class="nb">require</span> <span class="n">f</span> <span class="k">unless</span> <span class="n">f</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/\/\..+$/</span><span class="p">)</span> <span class="o">||</span> <span class="no">File</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>modified config.ru</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Load path and gems/bundler</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;./env_loader&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Load app</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;hello_blog&quot;</span>
</span><span class='line'><span class="n">run</span> <span class="no">HelloBlog</span>
</span></code></pre></td></tr></table></div></figure>


<p>run</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rake</span> <span class="n">spec</span>
</span></code></pre></td></tr></table></div></figure>


<p>to check if it&rsquo;s working.</p>

<p>now there is a base setup so lets create post CRUD</p>

<ul>
<li>Create model and migration</li>
</ul>


<p>Inside lib folder create post.rb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">Sequel</span><span class="o">::</span><span class="no">Model</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>simple Post class extending Sequel Model</p>

<p>Next inside db/migrate folder create new file:</p>

<p>db/migrate/001_create_posts.rb</p>

<p><code>remember sequel migration naming convention [nomber]_description.rb, you will get errors if you don't follow.</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Sequel</span><span class="o">.</span><span class="n">migration</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">up</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">create_table</span><span class="p">(</span><span class="ss">:posts</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">primary_key</span> <span class="ss">:id</span>
</span><span class='line'>      <span class="n">column</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">:unique</span><span class="o">=&gt;</span><span class="kp">true</span>
</span><span class='line'>      <span class="n">column</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">:text</span><span class="p">,</span> <span class="ss">:unique</span><span class="o">=&gt;</span><span class="kp">true</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">down</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">drop_table</span><span class="p">(</span><span class="ss">:posts</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now simply run</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span>
</span></code></pre></td></tr></table></div></figure>


<p>If everything is done correctly you shouldn&rsquo;t see any message, if you do:</p>

<p>&ndash; you could forgot creteing database, simply login to your db shell and type</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">blog</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>&ndash; add <code>"postgres"</code> to Gemfile and run bundle install</p>

<ul>
<li>Create views</li>
</ul>


<p>&ndash; Index</p>

<p>create <code>views/posts.erb</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;h2&gt;</span>Posts<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>% Post.all.each do |e| %&gt;
</span><span class='line'>      <span class="nt">&lt;li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&lt;%= url &quot;</span><span class="na">posts</span><span class="err">/#{</span><span class="na">e</span><span class="err">.</span><span class="na">id</span><span class="err">}&quot;</span> <span class="err">%</span><span class="nt">&gt;</span>&quot;&gt;
</span><span class='line'>          <span class="nt">&lt;h4&gt;</span><span class="err">&lt;</span>%= e.title %&gt;<span class="nt">&lt;/h4&gt;&lt;/br&gt;&lt;/a&gt;</span>
</span><span class='line'>          <span class="nt">&lt;p&gt;</span><span class="err">&lt;</span>%= e.body.truncate(10) || &quot;N/A&quot; %&gt;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="err">&lt;</span>% end %&gt;
</span><span class='line'>  <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;sidebar&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h3&gt;</span>Environment<span class="nt">&lt;/h3&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Ruby:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= RUBY_VERSION %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Environment:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= ENV[&quot;RACK_ENV&quot;] %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Server:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= @env[&quot;SERVER_SOFTWARE&quot;] %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;li&gt;&lt;b&gt;</span>Port:<span class="nt">&lt;/b&gt;</span> <span class="err">&lt;</span>%= @env[&quot;SERVER_PORT&quot;] %&gt;<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>next add mapping in app class:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">HelloBlog</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:public_folder</span> <span class="o">=&gt;</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span> <span class="ss">:static</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">get</span> <span class="s2">&quot;/&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">erb</span> <span class="ss">:posts</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>&ndash; View single post</p>

<p>in index file there is href in title:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&lt;%= url &quot;</span><span class="na">posts</span><span class="err">/#{</span><span class="na">e</span><span class="err">.</span><span class="na">id</span><span class="err">}&quot;</span> <span class="err">%</span><span class="nt">&gt;</span>&quot;&gt;
</span></code></pre></td></tr></table></div></figure>


<p>so we need to map /posts/:id in our app class</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">HelloBlog</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">set</span> <span class="ss">:public_folder</span> <span class="o">=&gt;</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span> <span class="ss">:static</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">get</span> <span class="s2">&quot;/&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">erb</span> <span class="ss">:posts</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">get</span> <span class="s2">&quot;/posts/:id&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">erb</span> <span class="ss">:post</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>TO BE COUNTINUED</h2>

<p>thats the first part of simple sinatra scaffold in next part we will cover creating deleting and updating our post</p>

<p>all code is avalible on <a href="https://github.com/marek2901/sinatra-scaffold-blog">github repo</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[#Pry - the Better Console]]></title>
    <link href="http://marek2901.github.io/blog/2016/03/22/number-pry-the-better-console/"/>
    <updated>2016-03-22T17:56:10+01:00</updated>
    <id>http://marek2901.github.io/blog/2016/03/22/number-pry-the-better-console</id>
    <content type="html"><![CDATA[<h2>What is pry?</h2>

<p>Pry is ruby console (irb) alternative, with syntax highlighting, runtime invocation and source code browsing.</p>

<!-- more -->


<p>to install it simply type:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install pry</span></code></pre></td></tr></table></div></figure>


<p>now you can use it by typing <code>pry</code> anywhere</p>

<h2>Why it is so powerful?</h2>

<p>type: <code>ls</code> to show current class (default is main) methods variables type:<code>cd</code> to change object.</p>

<p>Just like navigating thru directories in Unix/Linux machine</p>

<p>For example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>➜ pry
</span><span class='line'>[1] pry(main)&gt; cd String
</span><span class='line'>[2] pry(String):1&gt; ls
</span><span class='line'>Object.methods: yaml_tag
</span><span class='line'>String.methods: try_convert
</span><span class='line'>String#methods:
</span><span class='line'>  %    ===          byteslice    chop        delete          each_line       freeze    insert   match      reverse     scrub        split        succ       to_r    unicode_normalize
</span><span class='line'>  *    =~           capitalize   chop!       delete!         empty?          getbyte   inspect  next       reverse!    scrub!       squeeze      succ!      to_s    unicode_normalize!
</span><span class='line'>  +    []           capitalize!  chr         downcase        encode          gsub      intern   next!      rindex      setbyte      squeeze!     sum        to_str  unicode_normalized?
</span><span class='line'>  +@   []=          casecmp      clear       downcase!       encode!         gsub!     length   oct        rjust       shellescape  start_with?  swapcase   to_sym  unpack
</span><span class='line'>  -@   ascii_only?  center       codepoints  dump            encoding        hash      lines    ord        rpartition  shellsplit   strip        swapcase!  tr      upcase
</span><span class='line'>  &lt;&lt;   b            chars        concat      each_byte       end_with?       hex       ljust    partition  rstrip      size         strip!       to_c       tr!     upcase!
</span><span class='line'>  &lt;=&gt;  bytes        chomp        count       each_char       eql?            include?  lstrip   prepend    rstrip!     slice        sub          to_f       tr_s    upto
</span><span class='line'>  ==   bytesize     chomp!       crypt       each_codepoint  force_encoding  index     lstrip!  replace    scan        slice!       sub!         to_i       tr_s!   valid_encoding?
</span><span class='line'>locals: _  __  _dir_  _ex_  _file_  _in_  _out_  _pry_</span></code></pre></td></tr></table></div></figure>


<p>Unless you forgot:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[8] pry(String):1&gt; whereami
</span><span class='line'>Inside String.</span></code></pre></td></tr></table></div></figure>


<p>Now go back</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[9] pry(String):1&gt; cd ..
</span><span class='line'>[10] pry(main)&gt;</span></code></pre></td></tr></table></div></figure>


<p>Write some class implementation</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[10] pry(main)&gt; class PryTest
</span><span class='line'>[10] pry(main)*
</span><span class='line'>[10] pry(main)*   def hello
</span><span class='line'>[10] pry(main)*     #simple method that returns hello world
</span><span class='line'>[10] pry(main)*     "hello world"
</span><span class='line'>[10] pry(main)*   end
</span><span class='line'>[10] pry(main)*
</span><span class='line'>[10] pry(main)* end</span></code></pre></td></tr></table></div></figure>


<p>cd into it</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[12] pry(main)&gt; cd PryTest
</span><span class='line'>[13] pry(PryTest):1&gt;</span></code></pre></td></tr></table></div></figure>


<p>and show-source</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[16] pry(PryTest):1&gt; show-source
</span><span class='line'>
</span><span class='line'>From: (pry) @ line 2:
</span><span class='line'>Class name: PryTest
</span><span class='line'>Number of lines: 8
</span><span class='line'>
</span><span class='line'>class PryTest
</span><span class='line'>
</span><span class='line'>  def hello
</span><span class='line'>    #simple method that returns hello world
</span><span class='line'>    "hello world"
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>We created class at runtime!!</p>

<p>Want more?</p>

<p>install pry-doc</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install pry-doc</span></code></pre></td></tr></table></div></figure>


<p>and</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pry
</span><span class='line'>
</span><span class='line'>[1] pry(main)&gt; cd String
</span><span class='line'>[2] pry(String):1&gt; show-method upcase
</span><span class='line'>
</span><span class='line'>From: string.c (C Method):
</span><span class='line'>Owner: String
</span><span class='line'>Visibility: public
</span><span class='line'>Number of lines: 7
</span><span class='line'>
</span><span class='line'>static VALUE
</span><span class='line'>rb_str_upcase(VALUE str)
</span><span class='line'>{
</span><span class='line'>    str = rb_str_dup(str);
</span><span class='line'>    rb_str_upcase_bang(str);
</span><span class='line'>    return str;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Native string method, so ruby is written in C but you should know that already :)</p>

<h2>Easy of reading</h2>

<p>Pry has built in code formatting and auto indent, so you always get nice looking output.</p>

<p>it uses <code>less</code> paginator, so you can scroll thru big amount of output.</p>

<h2>Executing methods</h2>

<p>This feature is obvious, when you are in console you can call invoke any ruby methods.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[7] pry(main)&gt; "Test string"
</span><span class='line'>=&gt; "Test string"
</span><span class='line'>
</span><span class='line'># _ stand for previus result "Test String" in this case
</span><span class='line'>[8] pry(main)&gt; _.reverse
</span><span class='line'>=&gt; "gnirts tseT"
</span><span class='line'>[9] pry(main)&gt; _.upcase
</span><span class='line'>=&gt; "GNIRTS TSET"
</span><span class='line'>[10] pry(main)&gt; _.reverse
</span><span class='line'>=&gt; "TEST STRING"
</span><span class='line'>[11] pry(main)&gt; _.downcase
</span><span class='line'>=&gt; "test string"
</span><span class='line'>[12] pry(main)&gt; _.capitalize
</span><span class='line'>=&gt; "Test string"
</span><span class='line'>[13] pry(main)&gt;</span></code></pre></td></tr></table></div></figure>


<h2>Wait for more</h2>

<p>There are much more features and plugins in pry cli tool, I will try to cover some of them in next posts.</p>

<p>Happy coding !!</p>

<hr />

<p>Read more at:
<a href="http://pryrepl.org">http://pryrepl.org</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby Environment Setup With Rbenv]]></title>
    <link href="http://marek2901.github.io/blog/2016/03/18/my-rbenv-configuration/"/>
    <updated>2016-03-18T17:14:02+01:00</updated>
    <id>http://marek2901.github.io/blog/2016/03/18/my-rbenv-configuration</id>
    <content type="html"><![CDATA[<h2>Ruby On Your computer</h2>

<p>There are few ways to get up and running with Ruby on your machine,
on OS X you have one right out of the box, on linux you can install it via
package managers (rpm, apt). But this approach gives you single out dated
ruby version you have to use. To avoid i use ruby env manager, so i can install
latest rubies (even developer previews), and switch them at runtime.</p>

<!-- more -->


<h3>1. Why I Use rbenv</h3>

<p>There are few ruby environment managers (rvm, rbenv, chruby), but i mostly use rbenv
because it&rsquo;s simple and has a lot of plugins. It allows to use different ruby versions
for different shell instances.</p>

<h3>2. Installation</h3>

<blockquote><p>Note: This is my personal setup with all my favorite plugins</p></blockquote>

<h4>Linux/Ubuntu</h4>

<p>1.Install dependecies</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get update && sudo apt-get install git-core curl zlib1g-dev build-essential libssl-dev libreadline-dev libyaml-dev libsqlite3-dev sqlite3 libxml2-dev libxslt1-dev libcurl4-openssl-dev python-software-properties libffi-dev</span></code></pre></td></tr></table></div></figure>


<p>2.Install rbenv</p>

<blockquote><p>Use .zshrc or bash_profile insted of bashrc depending on your shell</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd
</span><span class='line'>git clone https://github.com/rbenv/rbenv.git ~/.rbenv
</span><span class='line'>echo 'export PATH="$HOME/.rbenv/bin:$PATH"' &gt;&gt; ~/.bashrc
</span><span class='line'>echo 'eval "$(rbenv init -)"' &gt;&gt; ~/.bashrc
</span><span class='line'>exec $SHELL
</span><span class='line'>
</span><span class='line'>git clone https://github.com/rbenv/ruby-build.git ~/.rbenv/plugins/ruby-build
</span><span class='line'>echo 'export PATH="$HOME/.rbenv/plugins/ruby-build/bin:$PATH"' &gt;&gt; ~/.bashrc
</span><span class='line'>exec $SHELL
</span><span class='line'>
</span><span class='line'>git clone https://github.com/rbenv/rbenv-gem-rehash.git ~/.rbenv/plugins/rbenv-gem-rehash
</span><span class='line'>
</span><span class='line'>rbenv install 2.3.0
</span><span class='line'>rbenv global 2.3.0
</span><span class='line'>
</span><span class='line'>ruby -v
</span><span class='line'># should give output with proper ruby version</span></code></pre></td></tr></table></div></figure>


<h4>OS X</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew install rbenv ruby-build
</span><span class='line'>
</span><span class='line'>echo 'if which rbenv &gt; /dev/null; then eval "$(rbenv init -)"; fi' &gt;&gt; ~/.bash_profile
</span><span class='line'>source ~/.bash_profile
</span><span class='line'>
</span><span class='line'>rbenv install 2.3.0
</span><span class='line'>rbenv global 2.3.0
</span><span class='line'>
</span><span class='line'>ruby -v
</span><span class='line'># should give output with proper ruby version</span></code></pre></td></tr></table></div></figure>


<h2>3.Install plugins</h2>

<ul>
<li>rbenv-rehash</li>
</ul>


<p>Automaticaly executes rbenv rehash when new shims added</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/sstephenson/rbenv-gem-rehash.git $(rbenv root)/plugins/rbenv-default-gems</span></code></pre></td></tr></table></div></figure>


<ul>
<li>rbenv-default-gems</li>
</ul>


<p>Install default gems at each ruby version</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/rbenv/rbenv-default-gems.git $(rbenv root)/plugins/rbenv-default-gems
</span><span class='line'>
</span><span class='line'>## always install bundler in new rubies
</span><span class='line'>echo bundler &gt;&gt; $(rbenv root)/default-gems</span></code></pre></td></tr></table></div></figure>


<ul>
<li>rbenv-bundle-exec</li>
</ul>


<p>When working on more than one project with bundler dependency, sometimes
there is dependency mismatch, for example in one project you use rails 3
and another you use rails 4, without this plugin, we would have to
manually write <code>bundle exec &lt;command&gt;</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>## no more need to prefix `bundle exec` in rails command
</span><span class='line'>
</span><span class='line'>git clone https://github.com/maljub01/rbenv-bundle-exec.git $(rbenv root)/plugins/rbenv-bundle-exec</span></code></pre></td></tr></table></div></figure>


<ul>
<li>rbenv-sudo</li>
</ul>


<p>simply type <code>rbenv sudo &lt;command&gt;</code> to execute it in sudo session</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/dcarley/rbenv-sudo.git $(rbenv root)/plugins/rbenv-sudo</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
</feed>
